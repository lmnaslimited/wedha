

**Practice 1**: Building a lencx Docker Image 
**Objective:** Learn how to build a custom Docker image using a `dockerfile` and dependencies.

## Steps:

**1. Prepare the Workspace**  
Navigate to the directory where you will create the necessary files and resources for building the Docker image. 
```bash  
mkdir -p /home/user/lens-docker/images/custom/ci /home/user/lens-docker/images/custom/resources  
cd /home/ajaykumar/lens-docker/images/custom  
```
**2. Create the `Containerfile (name of the dockerfile)`**  
Create the `Containerfile` in the `/home/user/lens-docker/images/custom` directory. 
```bash  
touch Containerfile  
```
 Add the content of the `Containerfile` from the following link:  
[Containerfile Content](https://github.com/frappe/frappe_docker/blob/main/images/custom/Containerfile)


 **3. Create the `apps.json` File**  
Create the `apps.json` file in the `/home/user/lens-docker/images/custom/ci` directory. 
```bash  
echo '[  
{  
"url": "[https://github.com/frappe/erpnext.git](https://github.com/frappe/erpnext.git)",  
"branch": "v14.44.0"  
},  
{  
"url": "[https://github.com/frappe/payments.git](https://github.com/frappe/payments.git)",  
"branch": "version-14"  
}  
]' > /home/user/lens-docker/images/custom/ci/apps.json  
```
 **4.Create the Nginx Resources**  
Navigate to the `resources` directory and create the Nginx configuration files. 
```bash  
cd /home/ajaykumar/lens-docker/images/custom/resources  
``` 
- **nginx-entrypoint- sh**  
Create and add the content from the following link by using any text editors like nano,vi or VS code:  
[nginx-entrypoint.sh Content](https://github.com/frappe/frappe_docker/blob/main/resources/nginx-entrypoint.sh).
- **nginx-template-conf:**  
Create and add the content from the following link:  
[nginx-template.conf Content](https://github.com/frappe/frappe_docker/blob/main/resources/nginx-template.conf).

**5. Verify the Directory Structure**  
Ensure that the directory structure is correct. 
```bash  
tree /home/user/lens-docker/images/custom  
```
 Expected output: 
 ```plaintext  
/home/user/lens-docker/images/custom  
├── Containerfile  
├── ci  
│ └── apps.json  
└── resources  
	├── nginx-entrypoint.sh  
	└── nginx-template.conf  
```
 **6.Prepare `apps.json` as Base64** 
Convert the `apps.json` file into a Base64 string for use in the Docker build process. 
```bash  
APPS_JSON_BASE64=$(base64 -w 0 ./ci/apps.json)  
```
**7. Build the Docker Image**  
Use the prepared Base64 string and build the Docker image with specific build arguments. 
```bash  
docker build --no-cache -t "lenscx:v14.51.0" \  
--build-arg FRAPPE_PATH="[https://github.com/frappe/frappe](https://github.com/frappe/frappe)" \  
--build-arg FRAPPE_BRANCH="v14.51.0" \  
--build-arg PYTHON_VERSION="3.10.12" \  
--build-arg NODE_VERSION="16.20.1" \  
--build-arg APPS_JSON_BASE64="${APPS_JSON_BASE64}" \  
-f "/home/ajaykumar/lens-docker/images/custom/Containerfile" \  
/home/ajaykumar/lens-docker/images/custom  
``` 
**Explanation:**  
- The `docker build` command uses various build arguments to customize the image.  
- The `APPS_JSON_BASE64` argument injects the apps configuration into the image.  
- The image is tagged as `lenscx:v14.51.0`.
- 
**8. Verify the Build**  
Once the build completes, verify the image creation. 
```bash  
docker images | grep lenscx  
```

**Expected Outcome:**
- A Docker image named `lenscx:v14.51.0` should be created.  
- The image should contain the Frappe framework, along with Nginx configured to serve the application.
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTY4MjExNjI2LDE2MTE5Njk3NzgsLTE5OD
YyNDUxMjAsNDA4MTg1Mjk4LC0zODEzODQ5MTYsMjEyNzUyMzg5
N119
-->