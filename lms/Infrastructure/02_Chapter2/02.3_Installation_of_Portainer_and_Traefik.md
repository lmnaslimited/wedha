
# Installing Portainer and Traefik in a Docker Swarm Cluster

## Pre-Requisites
You can install both Portainer and Traefik together using a pre-configured Docker Swarm setup from the following repository:

1. **Clone the Repository**:
   Run this command to clone the repository that contains the pre-configured Docker Swarm setup for Traefik and Portainer.
   ```bash
   git clone https://github.com/lmnaslimited/lensdocker.git
   ```

2. **Change to the Directory**:
   Navigate into the cloned directory before running further commands.
   ```bash
   cd lensdocker
   ```

3. **Initialize Docker Swarm**:
   This command initializes Docker Swarm on the machine, preparing it to orchestrate services.
   ```bash
   docker swarm init
   ```

4. **Configure Traefik**:
   - **Update Node Labels for Traefik**: This command adds a label to the Docker node indicating that it will be used by Traefik for managing SSL certificates.
     ```bash
     docker node update --label-add traefik-public.traefik-public-certificates=true $(docker info -f '{{.Swarm.NodeID}}')
     ```

   - **Set Environment Variables for Email and Traefik Domain**:
     Replace `myemail@example.com` with your actual email, and the domain (if you are not using `traefik.docker.localhost`) can be updated to match your setup.
     ```bash
     export EMAIL=myemail@example.com
     export TRAEFIK_DOMAIN=traefik.docker.localhost
     ```

   - **Set Hashed Password**: Use this command to set a hashed password for secure access. You will be prompted to enter and confirm your password.
     ```bash
     export HASHED_PASSWORD=$(openssl passwd -apr1)
     ```

   - **Deploy the Traefik Stack**: This command deploys Traefik using the `traefik-host.yml` configuration file.
     ```bash
     docker stack deploy -c compose/traefik-host.yml traefik
     ```

5. **Configure Portainer**:
   - **Update Node Labels for Portainer**: Add a label to the node to indicate that it will store Portainer data.
     ```bash
     docker node update --label-add portainer.portainer-data=true $(docker info -f '{{.Swarm.NodeID}}')
     ```

   - **Set Environment Variables for Portainer Domain**: Define the domain name for Portainer. You can replace `portainer.localhost` with the domain name you want to use if itâ€™s different.
     ```bash
     export PORTAINER_DOMAIN=portainer.localhost
     ```

   - **Deploy the Portainer Stack**: This command deploys Portainer using the `portainer.yml` configuration file.
     ```bash
     docker stack deploy -c compose/portainer.yml portainer
     ```

6. **Access Portainer**:
   Once the Portainer stack is deployed, open a browser and go to the URL specified for Portainer (in this case, `portainer.docker.localhost`). You will be taken to the Portainer setup page to complete the configuration.

### What to Replace:
- Replace `myemail@example.com` with your actual email in the command:
  ```bash
  export EMAIL=myemail@example.com
  ```
- Enter your password when prompted by the command to generate the hashed password:
  ```bash
  export HASHED_PASSWORD=$(openssl passwd -apr1)
  ```
- If necessary, replace the `TRAEFIK_DOMAIN` and `PORTAINER_DOMAIN` values with the actual domains you want to use for Traefik and Portainer.

These steps will ensure both Traefik and Portainer are configured and running in your Docker Swarm environment.
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTE2ODEzOTg1ODgsMTc1ODA1NTA1N119
-->